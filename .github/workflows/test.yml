# GitHub Actions workflow for running unit tests
# Triggers on every push and pull request to ensure code quality
name: Unit Tests

on:
  push:
  pull_request:
    branches: [main, develop, master]

jobs:
  unit-tests:
    name: Unit Tests
    runs-on: ubuntu-latest

    steps:
      # Check out the repository code
      - name: Checkout code
        uses: actions/checkout@v4

      # Set up pixi for dependency management
      - name: Setup pixi
        uses: prefix-dev/setup-pixi@v0.9.3
        with:
          pixi-version: v0.59.0
          cache: true
          cache-write: ${{ github.event_name == 'push' && github.ref_name == 'main' }}

      # Install project dependencies in dev environment
      - name: Install dependencies
        run: pixi install --environment dev

      # Run unit tests
      - name: Run unit tests
        env:
          NEUPRINT_TOKEN: ${{ secrets.FRANKS_NEUPRINT_TOKEN }}
        run: pixi run --environment dev unit-test-verbose

  integration-tests:
    name: Integration Tests
    runs-on: ubuntu-latest

    steps:
      # Check out the repository code
      - name: Checkout code
        uses: actions/checkout@v4

      # Set up pixi for dependency management
      - name: Setup pixi
        uses: prefix-dev/setup-pixi@v0.9.3
        with:
          pixi-version: v0.59.0
          cache: true
          cache-write: ${{ github.event_name == 'push' && github.ref_name == 'main' }}

      # Install project dependencies in dev environment
      - name: Install dependencies
        run: pixi install --environment dev

      # Run integration tests
      - name: Run integration tests
        env:
          NEUPRINT_TOKEN: ${{ secrets.FRANKS_NEUPRINT_TOKEN }}
        run: pixi run --environment dev integration-test-verbose
